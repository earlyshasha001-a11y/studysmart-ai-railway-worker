Your job is to ensure that Replit acts only as a lightweight automation controller,
while all heavy computation (DeepSeek V3.1 generation, validation, and saving) runs
on Railway using the â€œluminous-expressionâ€ project.

===============================
ðŸ§  SYSTEM ROLE
===============================
- Replit: lightweight manager
  â€¢ Handles API triggers, logging, and monitoring
  â€¢ Never runs DeepSeek generation locally
  â€¢ Keeps total storage below 200 MB
  â€¢ Sends task batches to Railway workers

- Railway: heavy executor
  â€¢ Uses DeepSeek V3.1 via OpenRouter endpoint
  â€¢ Runs JSON generation, quality validation, and saving
  â€¢ Auto-shuts down after completing each batch
  â€¢ Returns summaries and logs to Replit

===============================
ðŸš€ WORKFLOW RULES
===============================
1ï¸âƒ£  Authenticate with Railway using:
    - RAILWAY_PROJECT_TOKEN
    - RAILWAY_PROJECT_ID

2ï¸âƒ£  Deploy a new worker pod when a batch starts:
    mutation($projectId:String!){
      deploymentCreate(input:{projectId:$projectId}){id url staticUrl}
    }

3ï¸âƒ£  Replit waits and polls Railway every 30 seconds until pod status = "SUCCESS" or "ACTIVE".

4ï¸âƒ£  Once active, send the following instruction batch to the worker:
    - Load curriculum directives and lesson mapping JSONs.
    - For each mapping, use DeepSeek V3.1 via OpenRouter:
      model: "deepseek/deepseek-chat"
      temperature: 0.7
      max_tokens: 8192
    - Generate one full StudySmart lesson (7000â€“8000 chars)
      following MASTER_DIRECTIVE_v7.2.json.

5ï¸âƒ£  Railway worker:
    - Saves each lesson JSON to /output/YYYY-MM-DD/
    - Logs every 30 seconds with memory + CPU usage
    - Retries failed generations up to 2 times
    - Stops automatically after finishing all lessons

6ï¸âƒ£  Replit controller:
    - Only receives completion signals, summaries, and file lists
    - Cleans logs older than 48 hours
    - Warns if output folder >190 MB

===============================
âš™ï¸ TECHNICAL RULES
===============================
- DeepSeek API endpoint: https://openrouter.ai/api/v1/chat/completions
- Authorization header: Bearer ${OPENROUTER_API_KEY}
- GraphQL endpoint for Railway: https://backboard.railway.com/graphql/v2
- Rate-limit wait between calls: 3â€“5 seconds
- All batch processes capped at 1000 lessons/run
- Max runtime per worker: 2 hours
- If CPU >85 % for >1 min â†’ pause queue temporarily

===============================
ðŸ“¦ ENVIRONMENT VARIABLES
===============================
RAILWAY_PROJECT_TOKEN = pt_â€¦
RAILWAY_PROJECT_ID = â€¦
OPENROUTER_API_KEY = â€¦

===============================
ðŸŽ¯ SUCCESS CONDITIONS
===============================
âœ… Replit never performs heavy generation locally  
âœ… Railway pod handles all DeepSeek V3.1 workloads  
âœ… Lessons saved in /output/YYYY-MM-DD/  
âœ… Automatic shutdown after job completion  
âœ… Logs show real-time progress and resource stats